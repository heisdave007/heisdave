# Password Reset System - Architecture & Flow Diagrams

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT (Browser)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  forgot-password.html      reset-password.html                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Email Input Form â”‚      â”‚ Password Form    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚           â”‚                         â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚
            â”‚ POST /forgot-password   â”‚ POST /reset-password/:token
            â”‚                         â”‚
            v                         v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVER (Node.js/Express)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Route Layer (routers/userRouters.js)             â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ /forgot-password  â†’  forgotPassword()                      â”‚ â”‚
â”‚  â”‚ /reset-password   â†’  resetPassword()                       â”‚ â”‚
â”‚  â”‚ /change-password  â†’  changePassword()                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Controller Layer (controllers/userController.js)       â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ â€¢ Validate input                                            â”‚ â”‚
â”‚  â”‚ â€¢ Generate tokens                                           â”‚ â”‚
â”‚  â”‚ â€¢ Hash passwords                                            â”‚ â”‚
â”‚  â”‚ â€¢ Send emails                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Utility Layer (utils/sendEmail.js, utils/resetToken.js) â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ â€¢ generateResetToken() â†’ crypto                             â”‚ â”‚
â”‚  â”‚ â€¢ sendEmail() â†’ nodemailer                                  â”‚ â”‚
â”‚  â”‚ â€¢ hashToken() â†’ SHA256                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚
        v               v
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Database â”‚      â”‚Email     â”‚
   â”‚(MongoDB) â”‚      â”‚Server    â”‚
   â”‚          â”‚      â”‚(Gmail)   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Forgot Password Flow

```
User clicks "Forgot Password"
        â†“
User enters email
        â†“
POST /forgot-password {email}
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ forgotPassword() Controller  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Find user by email        â”‚
â”‚    â†“                          â”‚
â”‚    User exists? â”€Noâ†’ 404     â”‚
â”‚    â†“ Yes                      â”‚
â”‚ 2. Generate random token     â”‚
â”‚    â€¢ 32-byte random bytes    â”‚
â”‚    â€¢ Convert to hex string   â”‚
â”‚    â†“                          â”‚
â”‚ 3. Hash token (SHA256)       â”‚
â”‚    â€¢ Store hashed version    â”‚
â”‚    â†“                          â”‚
â”‚ 4. Save to database          â”‚
â”‚    â€¢ passwordResetToken      â”‚
â”‚    â€¢ passwordResetExpires    â”‚
â”‚    â€¢ (10 minutes from now)   â”‚
â”‚    â†“                          â”‚
â”‚ 5. Send email                â”‚
â”‚    â€¢ HTML template           â”‚
â”‚    â€¢ Reset link with token   â”‚
â”‚    â†“                          â”‚
â”‚ 6. Return success response   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
User receives email
        â†“
User clicks reset link
        â†“
Redirects to reset-password.html?token=...
```

---

## ğŸ” Reset Password Flow

```
User clicks reset link with token
        â†“
reset-password.html loads
        â†“
User enters new password
        â†“
POST /reset-password/:token {password, confirmPassword}
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ resetPassword() Controller                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Extract token from URL params            â”‚
â”‚    â†“                                         â”‚
â”‚ 2. Hash token (SHA256)                      â”‚
â”‚    â†“                                         â”‚
â”‚ 3. Find user with token                     â”‚
â”‚    â€¢ Password reset token matches?          â”‚
â”‚    â€¢ Token not expired?                     â”‚
â”‚    â†“ No                                      â”‚
â”‚    400: Invalid or expired token            â”‚
â”‚    â†“ Yes                                     â”‚
â”‚ 4. Validate passwords                       â”‚
â”‚    â€¢ Password matches confirmPassword?      â”‚
â”‚    â€¢ Password length >= 8?                  â”‚
â”‚    â†“ No                                      â”‚
â”‚    400: Validation error                    â”‚
â”‚    â†“ Yes                                     â”‚
â”‚ 5. Hash new password (bcrypt)               â”‚
â”‚    â†“                                         â”‚
â”‚ 6. Update user document                     â”‚
â”‚    â€¢ password (hashed)                      â”‚
â”‚    â€¢ passwordChangedAt (timestamp)          â”‚
â”‚    â€¢ passwordResetToken (clear)             â”‚
â”‚    â€¢ passwordResetExpires (clear)           â”‚
â”‚    â†“                                         â”‚
â”‚ 7. Save to database                         â”‚
â”‚    â†“                                         â”‚
â”‚ 8. Return success response                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
User sees success message
        â†“
Auto-redirect to login page
        â†“
User logs in with new password
```

---

## ğŸ‘¤ Change Password Flow (Authenticated Users)

```
Logged-in user goes to change password
        â†“
POST /change-password {currentPassword, newPassword, confirmPassword}
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ protectedRoute Middleware                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Extract JWT token from Authorization header      â”‚
â”‚    â†“                                                  â”‚
â”‚ 2. Verify JWT token signature                       â”‚
â”‚    â†“ Invalid                                          â”‚
â”‚    401: Unauthorized                                â”‚
â”‚    â†“ Valid                                            â”‚
â”‚ 3. Extract user ID from decoded token              â”‚
â”‚    â†“                                                  â”‚
â”‚ 4. Find user in database                           â”‚
â”‚    â†“                                                  â”‚
â”‚ 5. Attach user to request object                   â”‚
â”‚    â†“                                                  â”‚
â”‚ 6. Call next() to proceed                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ changePassword() Controller                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. Get user ID from req.user                        â”‚
â”‚    â†“                                                  â”‚
â”‚ 2. Fetch user with password field                  â”‚
â”‚    â†“                                                  â”‚
â”‚ 3. Compare currentPassword with stored hash        â”‚
â”‚    await user.comparePassword()                     â”‚
â”‚    â†“ No match                                        â”‚
â”‚    401: Current password incorrect                 â”‚
â”‚    â†“ Match                                           â”‚
â”‚ 4. Validate passwords                               â”‚
â”‚    â€¢ newPassword === confirmPassword?               â”‚
â”‚    â€¢ newPassword length >= 8?                       â”‚
â”‚    â†“ No                                              â”‚
â”‚    400: Validation error                            â”‚
â”‚    â†“ Yes                                             â”‚
â”‚ 5. Update password (will be hashed by pre-save)    â”‚
â”‚    â€¢ password = newPassword                         â”‚
â”‚    â€¢ confirmPassword = newPassword                  â”‚
â”‚    â€¢ passwordChangedAt = now                        â”‚
â”‚    â†“                                                  â”‚
â”‚ 6. Save to database (bcrypt hashes password)       â”‚
â”‚    â†“                                                  â”‚
â”‚ 7. Generate new JWT token (auto-login)             â”‚
â”‚    â†“                                                  â”‚
â”‚ 8. Return success + new token + user               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
User logged in with new token automatically
        â†“
Can use new token for subsequent requests
```

---

## ğŸ”„ Token Lifecycle

```
1. GENERATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ crypto.randomBytes(32)              â”‚
   â”‚ â†’ 32 random bytes                   â”‚
   â”‚ â†’ Convert to hex string (64 chars)  â”‚
   â”‚ Raw Token: a1b2c3d4e5f6...         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. HASHING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ crypto.createHash('sha256')         â”‚
   â”‚ â†’ Hash raw token                    â”‚
   â”‚ Hashed: 7d8f9e0a1b2c3d...          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. STORAGE
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Database (MongoDB)                  â”‚
   â”‚                                     â”‚
   â”‚ passwordResetToken: {hashed}        â”‚
   â”‚ passwordResetExpires: {timestamp}   â”‚
   â”‚ (expires in 10 minutes)             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. EMAIL TRANSMISSION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Email Body                          â”‚
   â”‚                                     â”‚
   â”‚ Reset Link:                         â”‚
   â”‚ /reset-password/{RAW_TOKEN}         â”‚
   â”‚                                     â”‚
   â”‚ (Send raw token, not hashed!)       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. USER RECEIVES EMAIL
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Email in Inbox                      â”‚
   â”‚                                     â”‚
   â”‚ Contains raw token in URL           â”‚
   â”‚ User clicks link                    â”‚
   â”‚ Token sent to reset endpoint        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

6. VERIFICATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Server receives raw token           â”‚
   â”‚ Hash it again (SHA256)              â”‚
   â”‚ Compare with stored hashed version  â”‚
   â”‚ â†“                                    â”‚
   â”‚ Match? â†’ Valid                      â”‚
   â”‚ Not match? â†’ Invalid                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

7. EXPIRATION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Check: passwordResetExpires         â”‚
   â”‚ Compare: now < passwordResetExpires â”‚
   â”‚ â†“                                    â”‚
   â”‚ True? â†’ Token valid                 â”‚
   â”‚ False? â†’ Token expired              â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

8. CLEANUP
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ After successful password reset:    â”‚
   â”‚                                     â”‚
   â”‚ passwordResetToken = undefined      â”‚
   â”‚ passwordResetExpires = undefined    â”‚
   â”‚                                     â”‚
   â”‚ Token removed from database         â”‚
   â”‚ Cannot be reused                    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Security Layers

```
                    User Request
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Layer 1: Input Validation          â”‚
        â”‚ âœ“ Email format validation          â”‚
        â”‚ âœ“ Password strength (8+ chars)     â”‚
        â”‚ âœ“ Password matching check          â”‚
        â”‚ âœ“ Required fields check            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Layer 2: Database Verification     â”‚
        â”‚ âœ“ User exists check               â”‚
        â”‚ âœ“ Email verification               â”‚
        â”‚ âœ“ Token existence check            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Layer 3: Token Security            â”‚
        â”‚ âœ“ Token hashing (SHA256)           â”‚
        â”‚ âœ“ Token expiration (10 min)        â”‚
        â”‚ âœ“ One-time use enforcement         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Layer 4: Password Security         â”‚
        â”‚ âœ“ Bcrypt hashing (10 rounds)       â”‚
        â”‚ âœ“ Password strength validation     â”‚
        â”‚ âœ“ Confirmation matching            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Layer 5: Authentication            â”‚
        â”‚ âœ“ JWT token validation             â”‚
        â”‚ âœ“ Protected route middleware       â”‚
        â”‚ âœ“ Current password verification    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Layer 6: Email Security            â”‚
        â”‚ âœ“ Secure SMTP connection           â”‚
        â”‚ âœ“ HTML email validation            â”‚
        â”‚ âœ“ App-specific passwords           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                    Success Response
```

---

## ğŸ“± Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚                      â”‚    Server        â”‚
â”‚             â”‚                      â”‚                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚HTML Formâ”‚ â”‚â”€â”€POST /forgotâ”€â”€â”€â”€â†’  â”‚ â”‚ Controller   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚                      â”‚         â”‚        â”‚
â”‚             â”‚â†â”€â”€â”€JSON Responseâ”€â”€â”€â”€ â”‚         â†“        â”‚
â”‚             â”‚                      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚             â”‚                      â”‚ â”‚ Utils        â”‚ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                      â”‚ â”‚ â€¢ sendEmail()â”‚ â”‚
â”‚ â”‚ Email   â”‚ â”‚â†â”€â”€Email with Linkâ”€â”€â”€ â”‚ â”‚ â€¢ hashToken()â”‚ â”‚
â”‚ â”‚ Inbox   â”‚ â”‚                      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                      â”‚         â”‚        â”‚
â”‚             â”‚                      â”‚         â†“        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Clickâ†’   â”‚ â”‚â”€â”€POST /reset:tokenâ”€â†’ â”‚ â”‚ Database     â”‚ â”‚
â”‚ â”‚Reset    â”‚ â”‚                      â”‚ â”‚ â€¢ User docs  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚                      â”‚                  â”‚
â”‚             â”‚â†â”€â”€â”€JSON Responseâ”€â”€â”€â”€ â”‚                  â”‚
â”‚             â”‚                      â”‚                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                      â”‚                  â”‚
â”‚ â”‚Success! â”‚ â”‚                      â”‚                  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                      â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Database State Changes

### Before Password Reset Request
```javascript
{
  _id: ObjectId("..."),
  email: "user@example.com",
  password: "$2b$10$hashedPassword...",
  passwordResetToken: undefined,
  passwordResetExpires: undefined,
  // ... other fields
}
```

### After Forgot Password Request
```javascript
{
  _id: ObjectId("..."),
  email: "user@example.com",
  password: "$2b$10$hashedPassword...",
  passwordResetToken: "hashedRandomToken...",
  passwordResetExpires: ISODate("2026-01-17T14:35:00Z"),
  // ... other fields
}
```

### After Successful Reset
```javascript
{
  _id: ObjectId("..."),
  email: "user@example.com",
  password: "$2b$10$newHashedPassword...",
  passwordResetToken: undefined,
  passwordResetExpires: undefined,
  passwordChangedAt: ISODate("2026-01-17T14:25:00Z"),
  // ... other fields
}
```

---

## ğŸš¨ Error Handling Flow

```
Request â†’ Validation â†’ Processing â†’ Response
                            â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“                â†“
                  Success         Error
                    â†“                â†“
              Return 200-201    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              + data            â”‚ Error Type  â”‚
                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                â”‚ 400 Input   â”‚
                                â”‚ 401 Auth    â”‚
                                â”‚ 404 Not     â”‚
                                â”‚    Found    â”‚
                                â”‚ 500 Server  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â†“
                                Return Error
                                Message
```

---

## âœ¨ Complete System Overview

```
                    PASSWORD RESET SYSTEM
                    
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend                              â”‚
â”‚  â€¢ forgot-password.html                                      â”‚
â”‚  â€¢ reset-password.html                                       â”‚
â”‚  â€¢ Change password in user profile                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚             â”‚
    /forgot         /reset      /change
   password       password    password
         â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Backend API                             â”‚
â”‚  â€¢ forgotPassword() â†’ Generate token, send email             â”‚
â”‚  â€¢ resetPassword() â†’ Verify token, update password           â”‚
â”‚  â€¢ changePassword() â†’ Verify current, update password        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
     Database        Email Service   Token Utils
     â€¢ Users         â€¢ SMTP Config    â€¢ Generate
     â€¢ Tokens        â€¢ HTML Template  â€¢ Hash
     â€¢ Passwords     â€¢ Error Handling â€¢ Validate
```

---

Created: January 17, 2026
System: Production-Ready âœ…
